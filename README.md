# microservice_postgresql

В рамках данного проекта было необходимо:

1. Развернуть базу PostgreSQL (9.6+)
2. Написать микросервис на языке Python 3, который:
    1. Принимает на вход файл с расширением «csv» или «xlsx».
    2. Создает таблицу с колонками из этого файла. Желательно, чтобы данные в колонке имели аналогичный таблице тип данных (строки, числа, даты и время). Если тип данных определить не удается (например, в исходном файле цифры в колонке идут вперемешку с текстом), то необходимо хранить такие строчки в формате строки.
    3. Если таблица с таким именем и колонками уже существует, добавляет данные в нее. Преобразование типа данных в колонках и запись в существующую таблицу не должны приводить к потере данных.
3. Желательно предусмотреть передачу дополнительных параметров микросервису и вариативность в формате передаваемых данных. Можно реализовать:
    1. Возможность задавать альтернативные названия колонок.
    2. Возможность задавать альтернативную позицию строки с заголовками.
    3. Возможность принудительно задавать формат колонки\колонок.
    4. Возможность создавать индекс на указанные колонки.
    5. Другие параметры по собственному усмотрению.

Мною были реализованы три модуля на языке Python 3:

preprocess.py отвечает за чтение передаваемого файла с данными, а также предобрабатывает данные, возвращая названия колонок в таблице, их типы и сами данные.

database.py разворачивает базу PostgreSQL, а также создает в ней таблицы и добавляет данные в уже существующие таблицы.

service.py через терминал, используя click, принимает путь до файла и другие параметры, передаваемые микросервису. Данный модуль запускает работу всего микросервиса.

test_microservice.py тестирует некоторые функции микросервиса с использованием pytests.

## Запуск микросервиса

Запуск осуществляется через терминал командой:

```
python service.py start {path} --database {database} --user {user} --password {password} --host {host} --port {port} --n {n}
```

1. Параметры указаны в фигурных скобках. Прописывать их в терминале не нужно. 
2. Опциональные параметры начинаются с `--`. Их указание не является обязательным, часть из них или все можно опустить.

`database`, `user`, `password`, `host`, `port` исползуются для соединения с базой данных. По умолчанию они заданы `database="mydatabase"`, `user="postgres"`, `password="12345"`, `host="127.0.0.1"`, `port="5432"`.

Опциональный параметр `n` необходимо указать, если вы хотите задать альтернативную позицию строки с заголовками. По умолчанию `n=0`, то есть в самой первой строчке файла находятся названия колонок.

Примеры команды запуска:

```
python service.py start students.xlsx

python service.py start new_data/students.csv
```
